<img src="src/passerby_service.gif"/>

# ğŸ•µğŸ» Passerby-Backend

### <div align="center"><b><i> Passerby, ì—¬ëŸ¬ë¶„ì˜ ì•ˆì „ì„ ì±…ì„ì§‘ë‹ˆë‹¤. </i></b></div>

&nbsp; 

> Passerby project
> 
> launched at 2023.06
> 
> Programmers AI DEV-course 5th

&nbsp; 

ğŸ¥ **Passerby**ëŠ” ê³µê°œìˆ˜ë°°ìë“¤ì˜ ì´ë¯¸ì§€ë¥¼ **AI ê¸°ìˆ **ì„ í†µí•˜ì—¬ ë¹„ë””ì˜¤ë¡œ ìƒì„±í•˜ì—¬ ì—¬ëŸ¬ë¶„ê»˜ ì œê³µí•©ë‹ˆë‹¤.

ğŸ‡°ğŸ‡· ë³¸ í”„ë¡œì íŠ¸ë¥¼ í†µí•´ íŒ€ b2winì€ **ë” ì•ˆì „í•œ ëŒ€í•œë¯¼êµ­, ë” ê±´ê°•í•œ ëŒ€í•œë¯¼êµ­**ì„ ê¿ˆê¿‰ë‹ˆë‹¤.

ğŸ’¾ ë³¸ ë¦¬í¬ì§€í† ë¦¬ëŠ” Passerbyì˜ DL model serving Server ì €ì¥ì†Œì…ë‹ˆë‹¤.
k11.6
ğŸš€ ë³¸ ë¦¬í¬ì§€í† ë¦¬ì˜ Image to Video ìƒì„± ëª¨ë¸ì€ pretrainëœ TPSM ëª¨ë¸ì„ ì°¨ìš©í•˜ì˜€ìŠµë‹ˆë‹¤. [(ì¶œì²˜)](https://github.com/yoyo-nb/Thin-Plate-Spline-Motion-Model)

&nbsp;

# âš™ï¸ Tech Stack

<div align="center">
<img src="https://img.shields.io/badge/Python-3776AB0?style=for-the-badge&logo=Python&logoColor=white"><img src="https://img.shields.io/badge/FastAPI-009688?style=for-the-badge&logo=FastAPI&logoColor=white"><img src="https://img.shields.io/badge/Pydantic-E92063?style=for-the-badge&logo=Pydantic&logoColor=white"><img src="https://img.shields.io/badge/Swagger-85EA2D?style=for-the-badge&logo=Swagger&logoColor=white"><img src="https://img.shields.io/badge/Amazon%20EC2-FF9900?style=for-the-badge&logo=Amazon%20EC2&logoColor=white"><img src="https://img.shields.io/badge/Docker-2496ED?style=for-the-badge&logo=Docker&logoColor=white"><img src="https://img.shields.io/badge/PyTorch-EE4C2C?style=for-the-badge&logo=PyTorch&logoColor=white">


</div>
&nbsp; 

# â“ About B2win Team

<div align="center">
  
| [@hwaxrang](https://github.com/hwaxrang) | [@Magenta195](https://github.com/Magenta195) | [@moongni](https://github.com/moongni) | [@heehaaaheeeee](https://github.com/heehaaaheeeee) | [@ShinEunChae](https://github.com/ShinEunChae) | [@joseokjun](https://github.com/joseokjun) |
|:---:|:---:|:---:|:---:|:---:|:---:|
| <img src="src/khr.png" width=200 /> | <img src="src/kth.jpeg" width=200 /> | <img src="src/mgh.png" width=200 /> | <img src="src/msh.jpg" width=200 /> | <img src="src/sec.jpeg" width=200 /> | <img src="src/jsj.jpg" width=200 /> |
| `ê¶Œí™”ë‘`   | `ê¹€íƒœí˜•` | `ë¬¸ê±´í¬` | `ë¬¸ìˆ™í¬` | `ì‹ ì€ì±„` | `ì¡°ì„ì¤€`  |

</div>

<div align="center">
<a href = "https://github.com/TeamB2win"><img alt="GitHub" src ="https://img.shields.io/badge/GitHub-181717.svg?&style=for-the-badge&logo=GitHub&logoColor=white"/></a>
<a href = "https://www.notion.so/B2Win-Between-a9b09623b67243319d9bbce293bfa46b?pvs=4"><img alt="Notion" src ="https://img.shields.io/badge/Notion-eeeeee.svg?&style=for-the-badge&logo=Notion&logoColor=black"/></a>
</div>




&nbsp; 

# ğŸ—ï¸ Key Service

ğŸ’¡ ì‚¬ìš©ìëŠ” passerby ì›¹ ë° ëª¨ë°”ì¼ í™˜ê²½ì— ì ‘ì†í•˜ì—¬ **ì „ì²´ ê³µê°œìˆ˜ë°°ì ì‹ ìƒì •ë³´**ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸ’¡ ë˜í•œ, ê³µê°œìˆ˜ë°°ì ì •ë³´ì™€ ëŒ€ì¡°í•˜ì—¬ ë°”ë¡œ ì œë³´ ë° ì‹ ê³ í•  ìˆ˜ ìˆë„ë¡ **ê´€ë ¨ ì•ˆë‚´ ì •ë³´**ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

ğŸ’¡ ê´€ë¦¬ìëŠ” passerby dbë¥¼ í†µí•˜ì—¬ ê³µê°œìˆ˜ë°°ì **ìƒì„±, ì¡°íšŒ**, ì´ë¯¸ì§€ ë° ë¹„ë””ì˜¤, ì‹ ìƒì •ë³´ì˜ **ìˆ˜ì •, ì‚­ì œ**ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

&nbsp;

# ğŸ§­ Structure

```bash
ğŸ—‚ï¸ DL-MODEL-SERVING
â”œâ”€â”€ ğŸ“‚ api
â”‚Â Â  â”œâ”€â”€ ğŸ“‚ errors
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ğŸ“„ __init__.py
â”‚Â Â  â”‚Â Â  â””â”€â”€ ğŸ“„ http_errors.py
â”‚Â Â  â”œâ”€â”€ ğŸ“‚ routes
â”‚Â Â  â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚Â Â  â”‚   â””â”€â”€ ğŸ“„ inference.py
â”‚Â Â  â”œâ”€â”€ ğŸ“„ __init__.py
â”‚Â Â  â””â”€â”€ ğŸ“„ endpoint.py
â”œâ”€â”€ ğŸ“‚ config
â”‚Â Â  â”œâ”€â”€ ğŸ“„ __init__.py
â”‚Â Â  â””â”€â”€ ğŸ“„ app.py
â”œâ”€â”€ ğŸ“‚ core
â”‚Â Â  â”œâ”€â”€ ğŸ“„ __init__.py
â”‚Â Â  â”œâ”€â”€ ğŸ“„ background_task.py
â”‚Â Â  â”œâ”€â”€ ğŸ“„ events.py
â”‚Â Â  â””â”€â”€ ğŸ“„ utils.py
â”œâ”€â”€ ğŸ“„ main.py
â”œâ”€â”€ ğŸ“‚ model
â”‚Â Â  â”œâ”€â”€ ğŸ“„ __init__.py
â”‚Â Â  â”œâ”€â”€ ğŸ“„ model.py
â”‚Â Â  â”œâ”€â”€ ğŸ“„ model_handler.py
â”‚Â Â  â””â”€â”€ ğŸ“‚ modules
â”‚Â Â      â”œâ”€â”€ ğŸ“„ __init__.py
â”‚Â Â      â”œâ”€â”€ ğŸ“„ avd_network.py
â”‚Â Â      â”œâ”€â”€ ğŸ“„ bg_motion_predictor.py
â”‚Â Â      â”œâ”€â”€ ğŸ“„ dense_motion.py
â”‚Â Â      â”œâ”€â”€ ğŸ“„ inpainting_network.py
â”‚Â Â      â”œâ”€â”€ ğŸ“„ keypoint_detector.py
â”‚Â Â      â”œâ”€â”€ ğŸ“„ model.py
â”‚Â Â      â””â”€â”€ ğŸ“„ util.py
â”œâ”€â”€ ğŸ“‚ resource
â”‚Â Â  â”œâ”€â”€ ğŸ“„ __init__.py
â”‚Â Â  â””â”€â”€ ğŸ“„ strings.py
â”œâ”€â”€ ğŸ“‚ schema
â”‚Â Â  â”œâ”€â”€ ğŸ“„ __init__.py
â”‚Â Â  â”œâ”€â”€ ğŸ“„ base.py
â”‚Â Â  â”œâ”€â”€ ğŸ“„ errors.py
â”‚Â Â  â”œâ”€â”€ ğŸ“„ inference_schema.py
â”‚Â Â  â””â”€â”€ ğŸ“„ priority_queue.py
â”œâ”€â”€ ğŸ“„ README.md
â””â”€â”€ ğŸ“„ run.sh
```
&nbsp;

# ğŸ“š API docs

ğŸ‘‰ ìì„¸í•œ request ë° response ë¬¸ë²•ì€ ë°±ì—”ë“œ ë‚´ swagger ë° redoc ë¬¸ì„œë¥¼ ì°¸ì¡°í•´ ì£¼ì„¸ìš”! (ì¶”í›„ ë¬¸ì„œë¶„ë¦¬ ì˜ˆì •)


|Router|Method|Endpoint|Description|
|---|---|---|---|
| admin | `POST` | `/api/inference` | ì§€ëª…ìˆ˜ë°°ì ì´ë¯¸ì§€ ì •ë³´ë¥¼ í† ëŒ€ë¡œ ML ëª¨ë¸ ì‘ì—… ì •ë³´ë¥¼ inference queueì— ì‚½ì… |




&nbsp;

# ğŸ“ Tutorial

ë³¸ model serving ë ˆí¬ì§€í† ë¦¬ëŠ” ë‹¤ìŒê³¼ ê°™ì€ í™˜ê²½ì—ì„œ ë™ì‘ì„ í™•ì¸í•˜ì˜€ìŠµë‹ˆë‹¤.

+ Python 3.10.8
+ CUDA 11.6
+ pytorch 1.13.1
+ Ubuntu linux ë„ì»¤ ì¸ìŠ¤í„´ìŠ¤


### prerequisite

ë³¸ DL_Model_ServerëŠ” FastAPI ê¸°ë°˜ì˜ ì„œë²„ í˜•ì‹ìœ¼ë¡œ êµ¬ë™ë˜ë©°, ì‹¤ì œ ì¶”ë¡ ì„ ìœ„í•´ì„œ API í˜•ì‹ìœ¼ë¡œ íë¥¼ ì‚½ì…í•´ì•¼ í•©ë‹ˆë‹¤.
ë˜í•œ, ìµœìƒìœ„ ë””ë ‰í† ë¦¬ì— `.env` íŒŒì¼ í˜•ì‹ì˜ ì„¤ì • íŒŒì¼ì´ í•„ìš”í•©ë‹ˆë‹¤. í¬í•¨ë˜ì–´ì•¼ í•˜ëŠ” ë³€ìˆ˜ëª… ë° ì •ë³´ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```bash
model_dir: ëª¨ë¸ ì¶”ë¡ ì— ì‚¬ìš©ë˜ëŠ” source ì €ì¥ ì£¼ì†Œ
backend_url: PasserBy Backend server ì£¼ì†Œ
video_dir: ìµœì¢… Video ìƒì„± ê²°ê³¼ë¬¼ì´ ì €ì¥ë˜ëŠ” ê²½ë¡œ
working_dir: ì„ì‹œ Video ìƒì„± ê²°ê³¼ë¬¼ë“¤ì´ ì €ì¥ë˜ëŠ” ê²½ë¡œ
```

ë˜í•œ, ìœ„ì˜ `model_dir` ì— í•´ë‹¹í•˜ëŠ” ê²½ë¡œì—ëŠ” ë‹¤ìŒ ë””ë ‰í† ë¦¬ê°€ êµ¬ì„±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. TPSM ëª¨ë¸ ê´€ë ¨ ì²´í¬í¬ì¸íŠ¸ ë° configëŠ” [ì—¬ê¸°](https://github.com/yoyo-nb/Thin-Plate-Spline-Motion-Model)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
ğŸ—‚ï¸ model_dir
â”œâ”€â”€ ğŸ“‚ model_file
â”‚Â Â  â”œâ”€â”€ ğŸ“‚ config
â”‚Â Â  â”‚   â””â”€â”€ ğŸ“„ vox-256.yaml     // TPSM model vox config file (see )
â”‚Â Â  â”œâ”€â”€ ğŸ“‚ driving_videos        // driving video to generate result
â”‚Â Â  â””â”€â”€ ğŸ“‚ weights
â”‚Â Â      â”œâ”€â”€ ğŸ“„ inception_v3.pth  // pretrained Inception model checkpoint
â”‚Â Â      â””â”€â”€ ğŸ“„ vox.pth.tar      // pretrained TPSM model checkpoint
â””â”€â”€ ğŸ“‚ result_logs              // path to save logs of model generation
```

### run

ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ ì£¼ì„¸ìš”.

```bash
sh run.sh
```

ë³¸ DL_Model_ServerëŠ” FastAPI ê¸°ë°˜ì˜ ì„œë²„ í˜•ì‹ìœ¼ë¡œ êµ¬ë™ë˜ë©°, ì‹¤ì œ ì¶”ë¡ ì„ ìœ„í•´ì„œ API í˜•ì‹ìœ¼ë¡œ íë¥¼ ì‚½ì…í•´ì•¼ í•©ë‹ˆë‹¤. ë°±ì—”ë“œ ì„œë²„ì™€ì˜ ì—°ë™ì„ ì „ì œë¡œ í•˜ê³  ìˆì–´ ë‹¨ì¼ ì„œë²„ ì‚¬ìš© ì‹œ ì •ìƒì‘ë™ì„ ë³´ì¦í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

